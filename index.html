<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gaby's Style - Cejas, Pesta√±as & Labios</title>
  
  <!-- Google Auth -->
  <meta name="google-signin-client_id" content="460424594977-cuo5kttqufdspj1vamu2dmo9tr9lpd5g.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // INICIALIZAR EMAILJS CON TUS CREDENCIALES
    emailjs.init("cV1a2nnO7ksij3b8B");
  </script>
  
  <style>
    /* TODOS LOS ESTILOS ANTERIORES SE MANTIENEN IGUAL */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #fff5f7 0%, #ffeef2 100%);
      color: #333;
      scroll-behavior: smooth;
    }

    /* ... (todos los estilos anteriores se mantienen igual) ... */

    /* NUEVOS ESTILOS PARA BOTONES DE ELIMINAR CITAS */
    .delete-btn {
      background: transparent;
      border: 1px solid #666;
      color: #666;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.7em;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .delete-btn:hover {
      background: #666;
      color: white;
    }
    
    .appointment-cancelled .appointment-actions {
      display: flex;
      justify-content: flex-end;
    }

    /* ... (el resto de estilos se mantienen igual) ... */
  </style>
</head>
<body>

  <!-- ... (todo el HTML anterior se mantiene igual) ... -->

  <!-- MODAL DE CITAS - CON FUNCIONALIDAD DE CANCELACI√ìN Y ELIMINACI√ìN -->
  <div class="appointments-modal">
    <div class="appointments-content">
      <span class="close-appointments" onclick="closeAppointmentsModal()">‚úñ</span>
      <h2>My Appointments</h2>
      <div class="appointments-list" id="appointmentsList">
        <!-- Las citas se cargar√°n din√°micamente aqu√≠ -->
      </div>
    </div>
  </div>

  <!-- ... (el resto del HTML se mantiene igual) ... -->

  <script>
    // SISTEMA DE AUTENTICACI√ìN REAL
    let userLoggedIn = false;
    let currentUser = null;
    let userAppointments = [];
    let userFavorites = [];

    // BASE DE DATOS DE USUARIOS (en localStorage)
    function getUsers() {
      return JSON.parse(localStorage.getItem('gabysStyleUsers')) || [];
    }

    function saveUsers(users) {
      localStorage.setItem('gabysStyleUsers', JSON.stringify(users));
    }

    function getUserData(email) {
      return JSON.parse(localStorage.getItem(`user_${email}`)) || { appointments: [], favorites: [] };
    }

    function saveUserData(email, data) {
      localStorage.setItem(`user_${email}`, JSON.stringify(data));
    }

    // ... (todas las funciones anteriores se mantienen igual) ...

    // FUNCIONES DE GESTI√ìN DE CITAS - ACTUALIZADAS
    function loadAppointments() {
      const appointmentsList = document.getElementById('appointmentsList');
      
      if (userAppointments.length === 0) {
        appointmentsList.innerHTML = `
          <div class="no-appointments">
            <i>üìÖ</i>
            <h3>No tienes citas programadas</h3>
            <p>¬°Reserva tu primera cita ahora!</p>
            <button class="cta-btn" onclick="closeAppointmentsModal(); openReservationModal();" style="margin-top: 15px;">Reservar Cita</button>
          </div>
        `;
        return;
      }

      appointmentsList.innerHTML = userAppointments.map(appointment => `
        <div class="appointment-card ${appointment.status === 'cancelled' ? 'appointment-cancelled' : ''}">
          <div class="appointment-header">
            <div class="appointment-service">
              ${appointment.service}
              ${appointment.status === 'cancelled' ? '<span class="cancelled-badge">Cancelada</span>' : ''}
              ${appointment.status === 'confirmed' ? '<span class="cancelled-badge" style="background: #2e7d32;">Confirmada</span>' : ''}
            </div>
            <div class="appointment-status ${appointment.status === 'confirmed' ? 'status-confirmed' : appointment.status === 'pending' ? 'status-pending' : 'status-cancelled'}">
              ${appointment.status === 'confirmed' ? 'Confirmada' : appointment.status === 'pending' ? 'Pendiente' : 'Cancelada'}
            </div>
          </div>
          <div class="appointment-details">
            <div class="appointment-date">
              <i>üìÖ</i>
              <span>${formatDate(appointment.date)}</span>
            </div>
            <div class="appointment-time">
              <i>‚è∞</i>
              <span>${appointment.time}</span>
            </div>
            <div class="appointment-location">
              <i>üìç</i>
              <span>${appointment.location}</span>
            </div>
          </div>
          ${appointment.status !== 'cancelled' ? `
            <div class="appointment-actions">
              <button class="cancel-btn" onclick="showCancelConfirmation(${appointment.id})">Cancelar</button>
            </div>
            <div class="cancel-confirmation" id="cancelConfirmation${appointment.id}">
              <p>¬øEst√°s segura de que quieres cancelar esta cita?</p>
              <div class="confirmation-buttons">
                <button class="confirm-cancel" onclick="cancelAppointment(${appointment.id})">S√≠, Cancelar</button>
                <button class="cancel-cancel" onclick="hideCancelConfirmation(${appointment.id})">No, Mantener</button>
              </div>
            </div>
          ` : `
            <div class="appointment-actions">
              <button class="delete-btn" onclick="deleteAppointment(${appointment.id})">Eliminar de la lista</button>
            </div>
          `}
        </div>
      `).join('');
    }

    function showCancelConfirmation(appointmentId) {
      document.getElementById(`cancelConfirmation${appointmentId}`).style.display = 'block';
    }

    function hideCancelConfirmation(appointmentId) {
      document.getElementById(`cancelConfirmation${appointmentId}`).style.display = 'none';
    }

    function cancelAppointment(appointmentId) {
      const appointmentIndex = userAppointments.findIndex(apt => apt.id === appointmentId);
      
      if (appointmentIndex !== -1) {
        userAppointments[appointmentIndex].status = 'cancelled';
        loadAppointments();
        showNotification('Cita cancelada correctamente');
        saveUserData(currentUser.email, {
          appointments: userAppointments,
          favorites: userFavorites
        });
        
        // Enviar notificaci√≥n por email
        sendCancellationEmail(userAppointments[appointmentIndex]);
      }
    }

    // NUEVA FUNCI√ìN PARA ELIMINAR CITAS CANCELADAS
    function deleteAppointment(appointmentId) {
      userAppointments = userAppointments.filter(apt => apt.id !== appointmentId);
      loadAppointments();
      showNotification('Cita eliminada de tu lista');
      saveUserData(currentUser.email, {
        appointments: userAppointments,
        favorites: userFavorites
      });
    }

    // SISTEMA DE NOTIFICACIONES CON EMAILJS - SOLO EMAIL
    function sendAppointmentNotifications(appointment) {
      console.log('üîî Enviando notificaciones por email...', appointment);
      
      // Enviar email a Gaby
      sendAppointmentEmailToGaby(appointment);
      
      // Enviar email de confirmaci√≥n al cliente
      sendConfirmationEmailToClient(appointment);
    }

    // EMAIL A GABY - Con el nuevo template
    function sendAppointmentEmailToGaby(appointment) {
      const templateParams = {
        client_name: appointment.clientName,
        client_email: appointment.clientEmail,
        client_phone: appointment.clientPhone,
        service: appointment.service,
        date: appointment.date,
        time: appointment.time,
        location: appointment.location,
        notes: appointment.notes,
        appointment_id: appointment.id,
        user_email: currentUser.email,
        to_email: 'gabysstylellc24@gmail.com'
      };

      console.log('üìß Enviando email a Gaby...', templateParams);

      // ENV√çO CON EL NUEVO TEMPLATE
      emailjs.send('service_wmf78jq', 'template_506avmk', templateParams)
          .then(function(response) {
              console.log('‚úÖ Email enviado a Gaby:', response);
          }, function(error) {
              console.error('‚ùå Error enviando email a Gaby:', error);
          });
    }

    // EMAIL DE CONFIRMACI√ìN AL CLIENTE
    function sendConfirmationEmailToClient(appointment) {
      const templateParams = {
        client_name: appointment.clientName,
        service: appointment.service,
        date: appointment.date,
        time: appointment.time,
        location: appointment.location,
        notes: appointment.notes,
        to_email: appointment.clientEmail
      };

      // Usar el template de confirmaci√≥n para el cliente
      emailjs.send('service_wmf78jq', 'template_eauk9ak', templateParams)
          .then(function(response) {
              console.log('‚úÖ Email de confirmaci√≥n enviado al cliente:', response);
          }, function(error) {
              console.error('‚ùå Error enviando email de confirmaci√≥n:', error);
          });
    }

    // EMAIL DE CANCELACI√ìN
    function sendCancellationEmail(appointment) {
      const templateParams = {
        client_name: appointment.clientName,
        service: appointment.service,
        date: appointment.date,
        time: appointment.time,
        to_email: appointment.clientEmail
      };

      // Usar template para cancelaci√≥n (puedes crear uno espec√≠fico)
      emailjs.send('service_wmf78jq', 'template_eauk9ak', templateParams)
          .then(function(response) {
              console.log('‚úÖ Email de cancelaci√≥n enviado:', response);
          }, function(error) {
              console.error('‚ùå Error enviando email de cancelaci√≥n:', error);
          });
    }

    // SISTEMA PARA QUE GABY ACEPTE CITAS DESDE EL EMAIL
    // Esta funci√≥n simula la aceptaci√≥n de una cita por parte de Gaby
    function acceptAppointment(appointmentId, userEmail) {
      // En un sistema real, esto se har√≠a desde el backend
      // Aqu√≠ simulamos la actualizaci√≥n en localStorage
      
      // Obtener datos del usuario
      const userData = getUserData(userEmail);
      if (!userData) return;
      
      // Buscar la cita y actualizar su estado
      const appointmentIndex = userData.appointments.findIndex(apt => apt.id === appointmentId);
      if (appointmentIndex !== -1) {
        userData.appointments[appointmentIndex].status = 'confirmed';
        saveUserData(userEmail, userData);
        
        // Si el usuario est√° logueado actualmente, actualizar la interfaz
        if (currentUser && currentUser.email === userEmail) {
          userAppointments = userData.appointments;
          if (document.querySelector('.appointments-modal').classList.contains('active')) {
            loadAppointments();
          }
        }
        
        // Enviar notificaci√≥n al usuario
        sendAppointmentAcceptedEmail(userData.appointments[appointmentIndex]);
        
        console.log(`‚úÖ Cita ${appointmentId} aceptada para ${userEmail}`);
      }
    }

    // EMAIL DE ACEPTACI√ìN DE CITA AL USUARIO
    function sendAppointmentAcceptedEmail(appointment) {
      const templateParams = {
        client_name: appointment.clientName,
        service: appointment.service,
        date: appointment.date,
        time: appointment.time,
        location: appointment.location,
        to_email: appointment.clientEmail
      };

      // Usar template para aceptaci√≥n de cita
      emailjs.send('service_wmf78jq', 'template_eauk9ak', templateParams)
          .then(function(response) {
              console.log('‚úÖ Email de aceptaci√≥n enviado al cliente:', response);
          }, function(error) {
              console.error('‚ùå Error enviando email de aceptaci√≥n:', error);
          });
    }

    // ... (el resto de las funciones se mantienen igual) ...

    // EVENT LISTENERS
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar sesi√≥n recordada
      checkRememberedUser();

      // Inicializar Google Sign-In cuando la API est√© cargada
      if (typeof google !== 'undefined') {
        initializeGoogleSignIn();
      } else {
        // Si Google no est√° disponible, reintentar despu√©s de un tiempo
        setTimeout(initializeGoogleSignIn, 1000);
      }

      // ... (todos los event listeners anteriores se mantienen igual) ...

      // Formulario de reservas - ACTUALIZADO CON SOLO EMAIL
      document.getElementById('reservationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!userLoggedIn) {
          showNotification('Debes iniciar sesi√≥n para reservar una cita.', 'error');
          closeReservationModal();
          openLoginModal();
          return;
        }
        
        const serviceText = document.getElementById('serviceSelect').options[document.getElementById('serviceSelect').selectedIndex].text;
        const newAppointment = {
          id: Date.now(),
          service: serviceText,
          date: document.getElementById('appointmentDate').value,
          time: document.getElementById('appointmentTime').value,
          location: document.querySelector('.location-option.selected') ? 
                   document.querySelector('.location-option.selected').getAttribute('data-location') : 'No especificado',
          status: "pending",
          clientName: document.getElementById('clientName').value,
          clientEmail: document.getElementById('clientEmail').value,
          clientPhone: document.getElementById('clientPhone').value,
          notes: document.getElementById('notes').value || 'No hay notas especificadas'
        };
        
        userAppointments.push(newAppointment);
        
        // Guardar datos
        saveUserData(currentUser.email, {
          appointments: userAppointments,
          favorites: userFavorites
        });
        
        // ENVIAR NOTIFICACIONES SOLO POR EMAIL
        sendAppointmentNotifications(newAppointment);
        
        showNotification('¬°Cita reservada correctamente! üìÖ Se ha enviado un email de confirmaci√≥n.');
        closeReservationModal();
        this.reset();
      });

      // ... (el resto de event listeners se mantienen igual) ...
    });

    // SIMULACI√ìN DE ACEPTACI√ìN DE CITA POR PARTE DE GABY
    // En un sistema real, esto se har√≠a desde el backend cuando Gaby haga clic en un enlace en el email
    // Aqu√≠ lo simulamos con una funci√≥n que se puede llamar desde la consola del navegador
    window.simulateAppointmentAcceptance = function(appointmentId, userEmail) {
      acceptAppointment(appointmentId, userEmail);
      alert(`Cita ${appointmentId} aceptada para ${userEmail}`);
    };
  </script>
</body>
</html>
   




